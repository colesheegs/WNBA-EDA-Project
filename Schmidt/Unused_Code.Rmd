```{r}
# wnba_shots <- wnba_shots |>
#   group_by(shooting_team) |>
#   mutate(
#     home_or_away = if_else(shooting_team == home_team_name, "Home", "Away"),
#     distance = as.numeric(str_extract(desc, "\\d{2}")),
#     attempted_point_value = if_else(
#       str_detect(desc, "[Ff]ree [Tt]hrow"), 1,
#       if_else(
#         str_detect(desc, "three point") | (distance > 21 & !is.na(distance)), 3, 2
#       )
#     )
#   )

# 
# View(wnba_shots)
# 
# wnba_shots |> 
#  filter(shot_value != attempted_point_value & shot_value > 0) |>
#   select(shooting_team, desc, shot_value, attempted_point_value)

```

```{r}
# wnba_shots |>
#   select(shooting_team, home_or_away, attempted_point_value, shot_value) |>
#   group_by(shooting_team, home_or_away, shot_value, attempted_point_value) |>
#   summarise(count = n())
#   
  
```


## Games With Close Scores (6 points or less) At Some Point In The Last 30 Seconds
```{r}
# End of game shots where the score differential was less than 6 after the shot was taken
end_of_game_shots <- wnba_shots |>
  filter(game_seconds_remaining <= 30 & score_differential %in% c(-6, -5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5, 6)) 


# Games That Had A Close Score At Some Point Within the last 30 seconds; The highest time where a shot occurred
close_games <- end_of_game_shots |> 
  group_by(game_id) |> 
  slice_max(game_seconds_remaining) |> 
  arrange(-free_throw) |> 
  slice_head() |>
  select(game_id, home_team_name, away_team_name, score_differential)


# The last shot of the every game 
final_score <- wnba_shots |> 
  group_by(game_id) |> 
  slice_min(game_seconds_remaining) |> 
  arrange(free_throw) |> 
  slice_head() |> 
   rename(final_score_differential = score_differential) |> 
   select(game_id, final_score_differential)

# Score Change From First Shot In Last 30 Seconds Where Score is 
close_games_observing <- left_join(close_games, final_score) |> 
  mutate(home_team_outcome =  
 if_else(score_differential > 0 & final_score_differential > 0 & score_differential == final_score_differential, "Kept Same Lead",
 if_else(score_differential > 0 & final_score_differential > 0 & score_differential > final_score_differential, "Kept Lead - Decreased",
 if_else(score_differential > 0 & final_score_differential > 0, "Kept Lead - Increased",
 if_else(score_differential > 0 & final_score_differential == 0, "Lost Lead - Tied", 
 if_else(score_differential > 0 & final_score_differential < 0, "Lost Lead - Lost", 
 if_else(score_differential < 0 & final_score_differential < 0 & score_differential == final_score_differential, "No Comeback",
 if_else(score_differential < 0 & final_score_differential < 0 & score_differential > final_score_differential, "Comeback - Not Enough",
 if_else(score_differential < 0 & final_score_differential < 0 & final_score_differential > score_differential, "No Comeback - Deficity Increased",
 if_else(score_differential < 0 & final_score_differential == 0, "Comeback - Tied",
 if_else(score_differential == 0 & final_score_differential == 0, "No Comeback - Tied",
 if_else(score_differential == 0 & final_score_differential > 0, "Took Lead From Tie",
 if_else(score_differential == 0 & final_score_differential < 0, "Lost From Tie", 
         "Took Lead")))))))))))))

close_games_observing


```


## Overtime
```{r}
# End of game shots where the score differential was less than 6 after the shot was taken
end_of_game_shots <- wnba_shots |>
  filter(game_seconds_remaining <= 30 & score_differential %in% c(-6, -5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5, 6)) 


# Games That Had A Close Score At Some Point Within the last 30 seconds; The highest time where a shot occurred
close_games <- end_of_game_shots |> 
  group_by(game_id) |> 
  slice_min(game_play_number) |> 
  slice_head() |>
  select(game_id, home_team_name, away_team_name, score_differential)


# The last shot of the every game 
final_score <- wnba_shots |> 
  group_by(game_id) |> 
  slice_max(game_play_number) |> 
  slice_head() |> 
   rename(final_score_differential = score_differential) |> 
   select(game_id, final_score_differential)